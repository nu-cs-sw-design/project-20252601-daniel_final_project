@startuml

package controller {
  class Main {
    +{static} main(args : String[]) : void
  }

  class GameController {
    -game : Game
    -ui : GameUI
    +GameController(game : Game, ui : GameUI)
    +initialize() : void
    +handleDrawCard() : void
    +handlePlayCard(cardIndex : int) : void
    +handleNopeResponse(wantsToNope : boolean) : void
    +handleDefusePosition(position : int) : void
    -processGameState() : void
  }
}

package view {
  interface GameObserver {
    +onTurnStarted(playerIndex : int) : void
    +onCardPlayed(playerIndex : int, cardType : CardType) : void
    +onNopeWindowOpened(sourcePlayerIndex : int, cardType : CardType) : void
    +onActionResolved(message : String) : void
    +onActionCancelled() : void
    +onExplosionTriggered(playerIndex : int) : void
    +onDefuseUsed(playerIndex : int) : void
    +onPlayerEliminated(playerIndex : int) : void
    +onGameOver(winnerIndex : int) : void
    +onError(message : String) : void
  }

  class GameUI {
    -controller : GameController
    +GameUI()
    +setController(controller : GameController) : void
    +onTurnStarted(playerIndex : int) : void
    +onCardPlayed(playerIndex : int, cardType : CardType) : void
    +onNopeWindowOpened(sourcePlayerIndex : int, cardType : CardType) : void
    +onActionResolved(message : String) : void
    +onActionCancelled() : void
    +onExplosionTriggered(playerIndex : int) : void
    +onDefuseUsed(playerIndex : int) : void
    +onPlayerEliminated(playerIndex : int) : void
    +onGameOver(winnerIndex : int) : void
    +onError(message : String) : void
    +displayPlayerHand(player : Player) : void
    +promptForAction() : int
    +promptForNopeResponse() : boolean
    +promptForDefusePosition(maxPosition : int) : int
  }
}

package model {
  interface GameContext {
    +getDeck() : Deck
    +getCurrentPlayer() : Player
    +getPlayerAtIndex(index : int) : Player
    +getNumberOfPlayers() : int
    +getCurrentPlayerIndex() : int
    +getGameState() : GameState
  }

  enum GameState {
    SETUP
    PLAYER_TURN
    NOPE_WINDOW
    EXPLOSION_PENDING
    GAME_OVER
  }

  class Game {
    -players : List<Player>
    -deck : Deck
    -currentPlayerIndex : int
    -state : GameState
    -turnManager : TurnManager
    -observers : List<GameObserver>
    -pendingAction : PendingAction
    +Game(numberOfPlayers : int, deck : Deck)
    +addObserver(observer : GameObserver) : void
    +removeObserver(observer : GameObserver) : void
    -notifyTurnStarted(playerIndex : int) : void
    -notifyCardPlayed(playerIndex : int, cardType : CardType) : void
    -notifyNopeWindow(playerIndex : int, cardType : CardType) : void
    -notifyActionResolved(message : String) : void
    -notifyActionCancelled() : void
    -notifyExplosion(playerIndex : int) : void
    -notifyDefuseUsed(playerIndex : int) : void
    -notifyPlayerEliminated(playerIndex : int) : void
    -notifyGameOver(winnerIndex : int) : void
    -notifyError(message : String) : void
    +getDeck() : Deck
    +getCurrentPlayer() : Player
    +getPlayerAtIndex(index : int) : Player
    +getNumberOfPlayers() : int
    +getCurrentPlayerIndex() : int
    +getGameState() : GameState
    +setGameState(state : GameState) : void
    +getPendingAction() : PendingAction
    +setPendingAction(action : PendingAction) : void
    +start() : void
    +drawCard() : void
    +playCard(cardIndex : int) : void
    +resolveNopeResponse(wantsToNope : boolean) : void
    +resolveDefusePosition(position : int) : void
    +advanceTurn() : void
    +eliminatePlayer(playerIndex : int) : void
    -checkWinCondition() : void
    -handleExplosion() : void
  }

  class TurnManager {
    -currentPlayerIndex : int
    -turnsRemaining : int
    -numberOfPlayers : int
    +TurnManager(numberOfPlayers : int)
    +getCurrentPlayerIndex() : int
    +getTurnsRemaining() : int
    +setTurnsRemaining(turns : int) : void
    +decrementTurns() : void
    +advanceToNextPlayer(players : List<Player>) : int
    +skipTurn() : void
    +addExtraTurns(turns : int) : void
  }

  class PendingAction {
    -{final} cardAction : CardAction
    -{final} sourcePlayerIndex : int
    -nopeCount : int
    -resolved : boolean
    +PendingAction(action : CardAction, playerIndex : int)
    +getCardAction() : CardAction
    +getSourcePlayerIndex() : int
    +getNopeCount() : int
    +addNope() : void
    +isNoped() : boolean
    +resolve(context : GameContext) : void
    +isResolved() : boolean
  }

  class Player {
    -{final} id : int
    -hand : List<Card>
    -alive : boolean
    +Player(id : int)
    +getId() : int
    +getHand() : List<Card>
    +getHandSize() : int
    +getCard(index : int) : Card
    +addCard(card : Card) : void
    +removeCard(index : int) : Card
    +hasCardOfType(type : CardType) : boolean
    +findCardOfType(type : CardType) : int
    +removeCardOfType(type : CardType) : Card
    +isAlive() : boolean
    +eliminate() : void
  }

  class Deck {
    -cards : List<Card>
    +Deck()
    +initialize(numberOfPlayers : int) : void
    +shuffle() : void
    +draw() : Card
    +insertAt(position : int, card : Card) : void
    +getSize() : int
    +isEmpty() : boolean
  }

  class Card {
    -{final} type : CardType
    -{final} action : CardAction
    +Card(type : CardType, action : CardAction)
    +getType() : CardType
    +getAction() : CardAction
  }

  enum CardType {
    EXPLODING_KITTEN
    DEFUSE
    NOPE
    SHUFFLE
  }

  class CardFactory {
    +{static} createCard(type : CardType) : Card
    +{static} createExplodingKitten() : Card
    +{static} createDefuse() : Card
    +{static} createNope() : Card
    +{static} createShuffle() : Card
  }

  interface CardAction {
    +execute(context : GameContext) : void
    +isNopeable() : boolean
    +getCardType() : CardType
  }

  class ExplodingKittenAction {
    +execute(context : GameContext) : void
    +isNopeable() : boolean
    +getCardType() : CardType
  }

  class DefuseAction {
    -insertPosition : int
    +setInsertPosition(position : int) : void
    +getInsertPosition() : int
    +execute(context : GameContext) : void
    +isNopeable() : boolean
    +getCardType() : CardType
  }

  class ShuffleAction {
    +execute(context : GameContext) : void
    +isNopeable() : boolean
    +getCardType() : CardType
  }

  class NopeAction {
    +execute(context : GameContext) : void
    +isNopeable() : boolean
    +getCardType() : CardType
  }

  package exceptions {
    class GameException {
      +GameException(message : String)
    }

    class InvalidMoveException {
      +InvalidMoveException(message : String)
    }

    class EmptyDeckException {
      +EmptyDeckException()
    }
  }
}

Game ..|> GameContext
GameUI ..|> GameObserver

ExplodingKittenAction ..|> CardAction
DefuseAction ..|> CardAction
ShuffleAction ..|> CardAction
NopeAction ..|> CardAction

InvalidMoveException --|> GameException
EmptyDeckException --|> GameException

Main ..> GameController
Main ..> GameUI
GameController --> Game
GameController --> GameUI
GameUI ..> GameController
Game --> TurnManager
Game --> Deck
Game --> Player
Game --> GameState
Game --> PendingAction
Game ..> GameObserver
Player --> Card
Deck --> Card
Card --> CardType
Card --> CardAction
CardFactory ..> Card
CardFactory ..> ExplodingKittenAction
CardFactory ..> DefuseAction
CardFactory ..> ShuffleAction
CardFactory ..> NopeAction
PendingAction --> CardAction
Deck ..> EmptyDeckException
Game ..> InvalidMoveException

@enduml
